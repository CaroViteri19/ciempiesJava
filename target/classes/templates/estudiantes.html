<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Estudiantes - CIEMPIÉS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex items-center justify-center space-x-4 mb-4">
                <img src="../assets/logo.jpeg" alt="Logo CIEMPIÉS" class="w-16 h-16 rounded-full shadow-lg">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">CIEMPIÉS</h1>
                    <p class="text-gray-600">Sistema de Gestión Integral</p>
                </div>
            </div>
            <h2 class="text-2xl font-semibold text-gray-700">Registro de Estudiantes</h2>
        </div>

        <!-- Alert Messages -->
        <div v-if="alert.show" :class="alert.class" class="mb-6 p-4 rounded-lg shadow-md">
            <div class="flex items-center">
                <i :class="alert.icon" class="mr-3"></i>
                <span>{{ alert.message }}</span>
            </div>
        </div>

        <!-- Form -->
        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
            <form @submit.prevent="submitForm" class="p-8">
                <!-- Personal Information Section -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-user-circle mr-2 text-purple-600"></i>
                        Información Personal
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-user mr-1"></i>Nombre *
                            </label>
                            <input 
                                v-model="form.nombre" 
                                type="text" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                placeholder="Ingrese el nombre">
                        </div>
                        
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-user mr-1"></i>Apellido *
                            </label>
                            <input 
                                v-model="form.apellido" 
                                type="text" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                placeholder="Ingrese el apellido">
                        </div>
                        
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-id-card mr-1"></i>Documento *
                            </label>
                            <input 
                                v-model="form.documento" 
                                type="text" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                placeholder="Número de documento">
                        </div>
                        
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-venus-mars mr-1"></i>Sexo *
                            </label>
                            <select 
                                v-model="form.sexo" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
                                <option value="">Seleccione el sexo</option>
                                <option value="FEMENINO">Femenino</option>
                                <option value="MASCULINO">Masculino</option>
                                <option value="OTRO">Otro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-birthday-cake mr-1"></i>Edad *
                            </label>
                            <input 
                                v-model.number="form.edad" 
                                type="number" 
                                min="3" 
                                max="18" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                placeholder="Edad (3-18 años)">
                        </div>
                        
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-phone mr-1"></i>Teléfono *
                            </label>
                            <input 
                                v-model="form.telefono" 
                                type="tel" 
                                required
                                pattern="[0-9]{10}"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                placeholder="Número de teléfono (10 dígitos)">
                        </div>
                    </div>
                </div>

                <!-- Academic Information Section -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-graduation-cap mr-2 text-blue-600"></i>
                        Información Académica
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-book mr-1"></i>Curso *
                            </label>
                            <select 
                                v-model="form.curso" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="">Seleccione el curso</option>
                                <option value="Transición">Transición</option>
                                <option value="Primero">Primero</option>
                                <option value="Segundo">Segundo</option>
                                <option value="Tercero">Tercero</option>
                                <option value="Cuarto">Cuarto</option>
                                <option value="Quinto">Quinto</option>
                                <option value="Sexto">Sexto</option>
                                <option value="Séptimo">Séptimo</option>
                                <option value="Octavo">Octavo</option>
                                <option value="Noveno">Noveno</option>
                                <option value="Décimo">Décimo</option>
                                <option value="Undécimo">Undécimo</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-route mr-1"></i>Ruta *
                            </label>
                            <select 
                                v-model="form.rutaId" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="">Seleccione la ruta</option>
                                <option v-for="ruta in rutas" :key="ruta.idRuta" :value="ruta.idRuta">
                                    {{ ruta.codRuta }} - {{ ruta.nombreRuta }} ({{ ruta.capacidadDisponible }} cupos)
                                </option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Additional Information Section -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-green-600"></i>
                        Información Adicional
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-heartbeat mr-1"></i>EPS *
                            </label>
                            <input 
                                v-model="form.eps" 
                                type="text" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                                placeholder="Nombre de la EPS">
                        </div>
                        
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-map-marker-alt mr-1"></i>Dirección *
                            </label>
                            <input 
                                v-model="form.direccion" 
                                type="text" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                                placeholder="Dirección de residencia">
                        </div>
                        
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-wheelchair mr-1"></i>Discapacidad
                            </label>
                            <input 
                                v-model="form.discapacidad" 
                                type="text" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                                placeholder="Tipo de discapacidad (opcional)">
                        </div>
                        
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-users mr-1"></i>Etnia
                            </label>
                            <input 
                                v-model="form.etnia" 
                                type="text" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                                placeholder="Etnia (opcional)">
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex flex-col sm:flex-row gap-4 justify-end">
                    <button 
                        type="button" 
                        @click="resetForm"
                        class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors flex items-center justify-center">
                        <i class="fas fa-undo mr-2"></i>
                        Limpiar
                    </button>
                    <button 
                        type="submit" 
                        :disabled="loading"
                        class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 transition-colors flex items-center justify-center">
                        <i v-if="loading" class="fas fa-spinner fa-spin mr-2"></i>
                        <i v-else class="fas fa-save mr-2"></i>
                        {{ loading ? 'Guardando...' : 'Guardar Estudiante' }}
                    </button>
                </div>
            </form>
        </div>

        <!-- Back Button -->
        <div class="text-center mt-8">
            <a href="../controlador/modulos.php" 
               class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>
                Volver al Menú Principal
            </a>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    form: {
                        nombre: '',
                        apellido: '',
                        documento: '',
                        sexo: '',
                        edad: null,
                        telefono: '',
                        curso: '',
                        rutaId: '',
                        eps: '',
                        direccion: '',
                        discapacidad: '',
                        etnia: ''
                    },
                    rutas: [],
                    loading: false,
                    alert: {
                        show: false,
                        message: '',
                        type: 'success',
                        class: '',
                        icon: ''
                    }
                }
            },
            mounted() {
                this.loadRutas();
            },
            methods: {
                async loadRutas() {
                    try {
                        const response = await axios.get('/api/rutas/activas');
                        this.rutas = response.data.data;
                    } catch (error) {
                        console.error('Error cargando rutas:', error);
                        this.showAlert('Error al cargar las rutas', 'error');
                    }
                },
                
                async submitForm() {
                    this.loading = true;
                    try {
                        const response = await axios.post('/api/estudiantes', this.form, {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('token')}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        this.showAlert('Estudiante registrado exitosamente', 'success');
                        this.resetForm();
                        
                    } catch (error) {
                        console.error('Error:', error);
                        const message = error.response?.data?.message || 'Error al registrar estudiante';
                        this.showAlert(message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                resetForm() {
                    this.form = {
                        nombre: '',
                        apellido: '',
                        documento: '',
                        sexo: '',
                        edad: null,
                        telefono: '',
                        curso: '',
                        rutaId: '',
                        eps: '',
                        direccion: '',
                        discapacidad: '',
                        etnia: ''
                    };
                },
                
                showAlert(message, type) {
                    this.alert = {
                        show: true,
                        message: message,
                        type: type,
                        class: type === 'success' 
                            ? 'bg-green-100 border border-green-400 text-green-700'
                            : 'bg-red-100 border border-red-400 text-red-700',
                        icon: type === 'success' 
                            ? 'fas fa-check-circle text-green-500'
                            : 'fas fa-exclamation-circle text-red-500'
                    };
                    
                    setTimeout(() => {
                        this.alert.show = false;
                    }, 5000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
