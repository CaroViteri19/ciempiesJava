<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CIEMPIÉS SGI - Sistema de Gestión Integral</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50"> 
   
  <div id="app" class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-7xl mx-auto items-start px-4 sm:px-6 py-8 lg:py-12">

    <!-- Lado Izquierdo -->
    <div class="space-y-6">
      <!-- Logo y botón juntos -->
      <div class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4 justify-center lg:justify-start mb-8">
        <img src="../assets/logo.jpeg" alt="Logo SGI" class="w-24 h-24 sm:w-32 sm:h-32 object-contain rounded-full shadow-lg">
        <a href="https://www.movilidadbogota.gov.co/web/ciempies" target="_blank" 
           class="flex items-center space-x-2 bg-gradient-to-r from-cyan-400 to-blue-500 text-white font-semibold px-4 py-2 rounded-full shadow-lg hover:from-cyan-500 hover:to-blue-600 transition-all duration-300 transform hover:scale-105">
          <i class="fas fa-external-link-alt"></i>
          <span class="hidden sm:inline">Ciempies Movilidad</span>
          <span class="sm:hidden">Movilidad</span>
        </a>
      </div>

      <!-- Título y descripción -->
      <div class="bg-gradient-to-r from-indigo-900 to-purple-900 rounded-xl p-6 text-white space-y-4 shadow-xl">
        <h2 class="text-3xl sm:text-4xl font-extrabold text-center bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent">
          CIEMPIÉS SGI
        </h2>
        <p class="text-sm sm:text-base italic text-center leading-relaxed">
          Sistema de Gestión Integral para el proyecto de movilidad infantil liderado por la Secretaría de Educación del Distrito y la Secretaría Distrital de Movilidad, que mediante caravanas a pie guiadas acompaña a niñas, niños y adolescentes en los recorridos al colegio y de regreso a casa.
        </p>
        <p class="text-cyan-200 text-center font-semibold">Ciempiés promueve la movilidad sostenible</p>
      </div>

      <!-- Estadísticas -->
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
        <div class="bg-white rounded-lg p-4 shadow-lg text-center transform hover:scale-105 transition-transform">
          <p class="text-2xl font-bold text-indigo-600">18</p>
          <p class="text-xs sm:text-sm uppercase font-semibold text-gray-600">Caminos Seguros</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-lg text-center transform hover:scale-105 transition-transform">
          <p class="text-2xl font-bold text-indigo-600">12</p>
          <p class="text-xs sm:text-sm uppercase font-semibold text-gray-600">Colegios</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-lg text-center transform hover:scale-105 transition-transform">
          <p class="text-2xl font-bold text-indigo-600">372</p>
          <p class="text-xs sm:text-sm uppercase font-semibold text-gray-600">Beneficiarios</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-lg text-center transform hover:scale-105 transition-transform">
          <p class="text-2xl font-bold text-indigo-600">6.176</p>
          <p class="text-xs sm:text-sm uppercase font-semibold text-gray-600">Viajes</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-lg text-center transform hover:scale-105 transition-transform">
          <p class="text-2xl font-bold text-indigo-600">40</p>
          <p class="text-xs sm:text-sm uppercase font-semibold text-gray-600">Monitores</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-lg text-center transform hover:scale-105 transition-transform">
          <p class="text-2xl font-bold text-indigo-600">744</p>
          <p class="text-xs sm:text-sm uppercase font-semibold text-gray-600">Acompañantes</p>
        </div>
      </div>
    </div>

    <!-- Lado Derecho -->
    <div class="space-y-6 flex flex-col justify-center lg:pt-8">
      <!-- Encabezado de acceso -->
      <div class="text-center">
        <h3 class="text-2xl font-bold text-gray-800 mb-2">Inicio de Sesión</h3>
        <p class="text-gray-600">Accede al sistema de gestión</p>
      </div>

      <!-- Formulario de ingreso -->
      <form @submit.prevent="login" class="w-full max-w-md bg-white p-6 rounded-xl shadow-xl space-y-4 self-center">
        <!-- Alertas -->
        <div v-if="alert.show" :class="alert.type === 'error' ? 'bg-red-100 border-red-400 text-red-700' : 'bg-green-100 border-green-400 text-green-700'" 
             class="p-3 rounded-lg border">
          <i :class="alert.type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-check-circle'" class="mr-2"></i>
          {{ alert.message }}
        </div>

        <div>
          <label class="block text-gray-700 mb-2 font-medium">
            <i class="fas fa-envelope mr-2"></i>Correo Electrónico
          </label>
          <input 
            type="email" 
            v-model="form.correo" 
            placeholder="correo@ejemplo.com" 
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
            :class="errors.correo ? 'border-red-500' : ''"
            required 
          />
          <p v-if="errors.correo" class="text-red-500 text-sm mt-1">{{ errors.correo }}</p>
        </div>

        <div>
          <label class="block text-gray-700 mb-2 font-medium">
            <i class="fas fa-lock mr-2"></i>Contraseña
          </label>
          <div class="relative">
            <input 
              :type="showPassword ? 'text' : 'password'" 
              v-model="form.contraseña" 
              placeholder="••••••••" 
              class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
              :class="errors.contraseña ? 'border-red-500' : ''"
              required 
            />
            <button 
              type="button"
              @click="showPassword = !showPassword"
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
            >
              <i :class="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
            </button>
          </div>
          <p v-if="errors.contraseña" class="text-red-500 text-sm mt-1">{{ errors.contraseña }}</p>
        </div>

        <div class="flex items-center space-x-2">
          <input 
            type="checkbox" 
            v-model="form.aceptarTerminos"
            class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" 
            required
          />
          <label class="text-sm text-gray-600">
            Acepto los <a href="#" class="text-indigo-600 hover:underline">términos y condiciones</a>
          </label>
        </div>

        <button 
          type="submit" 
          :disabled="loading"
          class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold px-6 py-3 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <i v-if="loading" class="fas fa-spinner fa-spin mr-2"></i>
          <i v-else class="fas fa-sign-in-alt mr-2"></i>
          {{ loading ? 'Iniciando sesión...' : 'Ingresar' }}
        </button>

        <div class="text-center">
          <a href="registro.html" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
            ¿No tienes cuenta? Regístrate aquí
          </a>
        </div>
      </form>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          form: {
            correo: '',
            contraseña: '',
            aceptarTerminos: false
          },
          errors: {
            correo: '',
            contraseña: ''
          },
          alert: {
            show: false,
            message: '',
            type: 'success'
          },
          loading: false,
          showPassword: false
        }
      },
      methods: {
        validateForm() {
          this.errors = {
            correo: '',
            contraseña: ''
          };

          // Validar correo
          if (!this.form.correo) {
            this.errors.correo = 'El correo es requerido';
          } else if (!this.isValidEmail(this.form.correo)) {
            this.errors.correo = 'Ingrese un correo válido';
          }

          // Validar contraseña
          if (!this.form.contraseña) {
            this.errors.contraseña = 'La contraseña es requerida';
          } else if (this.form.contraseña.length < 6) {
            this.errors.contraseña = 'La contraseña debe tener al menos 6 caracteres';
          }

          return !this.errors.correo && !this.errors.contraseña;
        },
        isValidEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
        },
        showAlert(message, type = 'success') {
          this.alert = {
            show: true,
            message,
            type
          };
          setTimeout(() => {
            this.alert.show = false;
          }, 5000);
        },
        async login() {
          if (!this.validateForm()) {
            return;
          }

          if (!this.form.aceptarTerminos) {
            this.showAlert('Debe aceptar los términos y condiciones', 'error');
            return;
          }

          this.loading = true;

          try {
            const response = await axios.post('http://localhost:8080/api/auth/login', {
              correo: this.form.correo,
              contraseña: this.form.contraseña
            });

            if (response.data.success) {
              // Guardar token en localStorage
              localStorage.setItem('token', response.data.data.token);
              localStorage.setItem('user', JSON.stringify(response.data.data.usuario));
              
              this.showAlert('Inicio de sesión exitoso', 'success');
              
              // Redirigir al dashboard
              setTimeout(() => {
                window.location.href = 'dashboard.html';
              }, 1000);
            }
          } catch (error) {
            console.error('Error en login:', error);
            let message = 'Error al iniciar sesión';
            
            if (error.response) {
              if (error.response.status === 401) {
                message = 'Credenciales incorrectas';
              } else if (error.response.data && error.response.data.message) {
                message = error.response.data.message;
              }
            }
            
            this.showAlert(message, 'error');
          } finally {
            this.loading = false;
          }
        }
      },
      mounted() {
        // Configurar axios
        axios.defaults.baseURL = 'http://localhost:8080';
        axios.defaults.headers.common['Content-Type'] = 'application/json';
      }
    }).mount('#app');
  </script>
</body>
</html>