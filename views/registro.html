<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro - CIEMPIÉS SGI</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
  <div id="app" class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
      <!-- Header -->
      <div class="text-center">
        <div class="flex justify-center mb-4">
          <img src="../assets/logo.jpeg" alt="Logo" class="h-16 w-16 rounded-full shadow-lg">
        </div>
        <h2 class="text-3xl font-extrabold text-gray-900">
          Crear Cuenta
        </h2>
        <p class="mt-2 text-sm text-gray-600">
          Únete al sistema de gestión integral de CIEMPIÉS
        </p>
      </div>

      <!-- Formulario de registro -->
      <form @submit.prevent="registrar" class="mt-8 space-y-6">
        <!-- Alertas -->
        <div v-if="alert.show" :class="alert.type === 'error' ? 'bg-red-100 border-red-400 text-red-700' : 'bg-green-100 border-green-400 text-green-700'" 
             class="p-4 rounded-lg border">
          <i :class="alert.type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-check-circle'" class="mr-2"></i>
          {{ alert.message }}
        </div>

        <!-- Información personal -->
        <div class="bg-white p-6 rounded-xl shadow-xl space-y-4">
          <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">
            <i class="fas fa-user mr-2"></i>Información Personal
          </h3>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                <i class="fas fa-user mr-1"></i>Nombre
              </label>
              <input 
                type="text" 
                v-model="form.nombre" 
                placeholder="Tu nombre completo" 
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                :class="errors.nombre ? 'border-red-500' : ''"
                required 
              />
              <p v-if="errors.nombre" class="text-red-500 text-xs mt-1">{{ errors.nombre }}</p>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                <i class="fas fa-envelope mr-1"></i>Correo Electrónico
              </label>
              <input 
                type="email" 
                v-model="form.correo" 
                placeholder="correo@ejemplo.com" 
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                :class="errors.correo ? 'border-red-500' : ''"
                required 
              />
              <p v-if="errors.correo" class="text-red-500 text-xs mt-1">{{ errors.correo }}</p>
            </div>
          </div>

          <!-- Contraseñas -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                <i class="fas fa-lock mr-1"></i>Contraseña
              </label>
              <div class="relative">
                <input 
                  :type="showPassword ? 'text' : 'password'" 
                  v-model="form.contraseña" 
                  placeholder="••••••••" 
                  class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                  :class="errors.contraseña ? 'border-red-500' : ''"
                  required 
                />
                <button 
                  type="button"
                  @click="showPassword = !showPassword"
                  class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                >
                  <i :class="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                </button>
              </div>
              <p v-if="errors.contraseña" class="text-red-500 text-xs mt-1">{{ errors.contraseña }}</p>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                <i class="fas fa-lock mr-1"></i>Confirmar Contraseña
              </label>
              <div class="relative">
                <input 
                  :type="showConfirmPassword ? 'text' : 'password'" 
                  v-model="form.confirmarContraseña" 
                  placeholder="••••••••" 
                  class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                  :class="errors.confirmarContraseña ? 'border-red-500' : ''"
                  required 
                />
                <button 
                  type="button"
                  @click="showConfirmPassword = !showConfirmPassword"
                  class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                >
                  <i :class="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                </button>
              </div>
              <p v-if="errors.confirmarContraseña" class="text-red-500 text-xs mt-1">{{ errors.confirmarContraseña }}</p>
            </div>
          </div>

          <!-- Rol -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              <i class="fas fa-user-tag mr-1"></i>Rol en el Sistema
            </label>
            <select 
              v-model="form.rol" 
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
              :class="errors.rol ? 'border-red-500' : ''"
              required
            >
              <option value="">Selecciona un rol</option>
              <option value="MONITOR">Monitor</option>
              <option value="COORDINADOR">Coordinador</option>
              <option value="ADMIN">Administrador</option>
            </select>
            <p v-if="errors.rol" class="text-red-500 text-xs mt-1">{{ errors.rol }}</p>
          </div>

          <!-- Términos y condiciones -->
          <div class="flex items-start space-x-2">
            <input 
              type="checkbox" 
              v-model="form.aceptarTerminos"
              class="w-4 h-4 mt-1 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" 
              required
            />
            <label class="text-sm text-gray-600">
              Acepto los <a href="#" class="text-indigo-600 hover:underline">términos y condiciones</a> y la 
              <a href="#" class="text-indigo-600 hover:underline">política de privacidad</a>
            </label>
          </div>
        </div>

        <!-- Botones -->
        <div class="space-y-4">
          <button 
            type="submit" 
            :disabled="loading"
            class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold px-6 py-3 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i v-if="loading" class="fas fa-spinner fa-spin mr-2"></i>
            <i v-else class="fas fa-user-plus mr-2"></i>
            {{ loading ? 'Creando cuenta...' : 'Crear Cuenta' }}
          </button>

          <div class="text-center">
            <a href="index.html" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
              <i class="fas fa-arrow-left mr-1"></i>¿Ya tienes cuenta? Inicia sesión
            </a>
          </div>
        </div>
      </form>

      <!-- Información adicional -->
      <div class="text-center text-xs text-gray-500">
        <p>Al registrarte, aceptas nuestros términos de servicio y política de privacidad.</p>
        <p class="mt-1">CIEMPIÉS SGI - Sistema de Gestión Integral</p>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          form: {
            nombre: '',
            correo: '',
            contraseña: '',
            confirmarContraseña: '',
            rol: '',
            aceptarTerminos: false
          },
          errors: {
            nombre: '',
            correo: '',
            contraseña: '',
            confirmarContraseña: '',
            rol: ''
          },
          alert: {
            show: false,
            message: '',
            type: 'success'
          },
          loading: false,
          showPassword: false,
          showConfirmPassword: false
        }
      },
      methods: {
        validateForm() {
          this.errors = {
            nombre: '',
            correo: '',
            contraseña: '',
            confirmarContraseña: '',
            rol: ''
          };

          let isValid = true;

          // Validar nombre
          if (!this.form.nombre.trim()) {
            this.errors.nombre = 'El nombre es requerido';
            isValid = false;
          } else if (this.form.nombre.trim().length < 2) {
            this.errors.nombre = 'El nombre debe tener al menos 2 caracteres';
            isValid = false;
          }

          // Validar correo
          if (!this.form.correo) {
            this.errors.correo = 'El correo es requerido';
            isValid = false;
          } else if (!this.isValidEmail(this.form.correo)) {
            this.errors.correo = 'Ingrese un correo válido';
            isValid = false;
          }

          // Validar contraseña
          if (!this.form.contraseña) {
            this.errors.contraseña = 'La contraseña es requerida';
            isValid = false;
          } else if (this.form.contraseña.length < 6) {
            this.errors.contraseña = 'La contraseña debe tener al menos 6 caracteres';
            isValid = false;
          } else if (!this.isValidPassword(this.form.contraseña)) {
            this.errors.contraseña = 'La contraseña debe contener al menos una letra y un número';
            isValid = false;
          }

          // Validar confirmación de contraseña
          if (!this.form.confirmarContraseña) {
            this.errors.confirmarContraseña = 'Confirme su contraseña';
            isValid = false;
          } else if (this.form.contraseña !== this.form.confirmarContraseña) {
            this.errors.confirmarContraseña = 'Las contraseñas no coinciden';
            isValid = false;
          }

          // Validar rol
          if (!this.form.rol) {
            this.errors.rol = 'Debe seleccionar un rol';
            isValid = false;
          }

          return isValid;
        },
        isValidEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
        },
        isValidPassword(password) {
          // Al menos una letra y un número
          const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*?&]{6,}$/;
          return passwordRegex.test(password);
        },
        showAlert(message, type = 'success') {
          this.alert = {
            show: true,
            message,
            type
          };
          setTimeout(() => {
            this.alert.show = false;
          }, 5000);
        },
        async registrar() {
          if (!this.validateForm()) {
            return;
          }

          if (!this.form.aceptarTerminos) {
            this.showAlert('Debe aceptar los términos y condiciones', 'error');
            return;
          }

          this.loading = true;

          try {
            const response = await axios.post('http://localhost:8080/api/auth/register', {
              nombre: this.form.nombre.trim(),
              correo: this.form.correo,
              contraseña: this.form.contraseña,
              rol: this.form.rol
            });

            if (response.data.success) {
              this.showAlert('Cuenta creada exitosamente. Redirigiendo al login...', 'success');
              
              // Limpiar formulario
              this.form = {
                nombre: '',
                correo: '',
                contraseña: '',
                confirmarContraseña: '',
                rol: '',
                aceptarTerminos: false
              };
              
              // Redirigir al login después de 2 segundos
              setTimeout(() => {
                window.location.href = 'index.html';
              }, 2000);
            }
          } catch (error) {
            console.error('Error en registro:', error);
            let message = 'Error al crear la cuenta';
            
            if (error.response) {
              if (error.response.status === 409) {
                message = 'El correo electrónico ya está registrado';
              } else if (error.response.data && error.response.data.message) {
                message = error.response.data.message;
              }
            }
            
            this.showAlert(message, 'error');
          } finally {
            this.loading = false;
          }
        }
      },
      mounted() {
        // Configurar axios
        axios.defaults.baseURL = 'http://localhost:8080';
        axios.defaults.headers.common['Content-Type'] = 'application/json';
      }
    }).mount('#app');
  </script>
</body>
</html>
